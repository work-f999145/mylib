# Техническое задание для функции restore_proxy
## Назначение функции:

Функция `restore_proxy` предназначена для автоматического управления и восстановления статуса прокси-серверов в системе с использованием многопоточности. Функция работает асинхронно и должна быть способна обрабатывать множественные прокси, которые могут блокироваться и разблокироваться динамично.

### Основные требования и функции:

1. **Многопоточная обработка**: Каждый прокси, который становится заблокированным (`False`), должен обрабатываться в отдельном потоке.
2. **Автоматическая разблокировка**: После заданного временного интервала (`timeout`), каждый прокси должен автоматически переходить в состояние разблокированного (`True`).
3. **Поддержка динамичного добавления прокси**: Система должна корректно обрабатывать добавление новых прокси в любой момент времени.
4. **Эффективное управление потоками**: Необходимо регулярно очищать завершённые потоки для предотвращения утечек ресурсов и переполнения памяти.

## Детали реализации:

- Входные параметры:

  - `locked_proxies`: Словарь (`multiprocessing.Manager().dict()`), где ключами являются идентификаторы прокси, а значениями — булевы флаги, указывающие, заблокирован прокси или нет.
  - timeout: Временной интервал в секундах, после которого заблокированный прокси должен быть автоматически разблокирован.

- Процесс работы:

  1. При обнаружении, что прокси заблокирован (значение `False`), для этого прокси запускается отдельный поток, который устанавливает таймер на время `timeout`.
  2. По истечении `timeout` прокси автоматически устанавливается в состояние `True`.
  3. Вся информация о потоках хранится в списке `all_threads`, который регулярно проверяется на предмет завершённых потоков. Завершённые потоки очищаются каждую минуту.
  4. Множество `active_proxies` используется для отслеживания прокси, для которых уже запущены потоки обработки.

- Менеджмент ресурсов:

  1. Очистка потоков производится путём вызова метода `join()` для завершённых потоков в функции `cleanup_threads`, которая вызывается каждую минуту.
  2. Очистка потоков помогает избегать накопления "мертвых" потоков, что важно для поддержания производительности и стабильности системы.

- Безопасность и стабильность:

   - Доступ к общим ресурсам, таким как словарь `locked_proxies` и список `all_threads`, синхронизируется с помощью блокировок (`Lock`), чтобы предотвратить гонки данных и другие проблемы многопоточности.

## Тестирование:

- Функция должна быть протестирована в условиях высокой нагрузки с сотнями прокси, которые блокируются и разблокируются.
- Необходимо убедиться, что после добавления новых прокси они корректно обрабатываются без влияния на уже обрабатываемые прокси.
- Тесты должны включать проверку памяти и производительности, чтобы убедиться, что утечек ресурсов не происходит.